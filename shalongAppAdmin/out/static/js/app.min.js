angular.module("JianzhiApp",["ionic","JianzhiApp.config","JianzhiApp.services"]).config(["$stateProvider","$urlRouterProvider","$ionicConfigProvider",function(i,n,e){i.state("admin",{url:"/admin","abstract":!0,templateUrl:"pages/menu.html",controller:"MyYCtrl"}).state("admin.jianzhi",{url:"/jianzhi",views:{adminjianzhi:{templateUrl:"pages/jianzhi.html",controller:"AdminjianzhiCtrl"}}}).state("admin.new",{url:"/new",views:{"new":{templateUrl:"pages/new.html",controller:"NewCtrl"}}}).state("adminLogin",{url:"/login",templateUrl:"pages/login.html",controller:"adminLoginCtrl"}),n.otherwise("/admin/jianzhi")}]).controller("MyYCtrl",["$scope","$state",function(i,n){i.search=function(){console.log("search")}}]);
angular.module("JianzhiApp.config",[]).constant("ENV",{name:"production",debug:!0,version:"1.0.0",api:"http://127.0.0.1:8000/jianzhi/api/v1"}).config(["$ionicConfigProvider",function(i){i.tabs.position("bottom")}]);
angular.module("JianzhiApp").controller("AdminjianzhiCtrl",["$scope","$ionicPopup","$log","$ionicModal","$rootScope","callApi","Admin","MessageShow","$ionicScrollDelegate","$state",function(e,n,t,o,i,a,s,c,r,l){function g(){console.log(s.judgeUser()),s.judgeUser()?(c.MessageShow("请先登录",1e3),l.go("adminLogin")):(S(d,function(){},0),o.fromTemplateUrl("detail.html",{scope:e,animation:"slide-in-up"}).then(function(n){e.modal=n}))}var u=s.getCurrentUser(),d=1,h=5,f=!0,m=[],S=function(n,t,o){var i=u.token;a.getData("/item/admin/list","POST",{pagenumber:n,pagesize:h},i).then(function(i){200==i.code?(console.log(i),p(i.content),e.no_content=!1,i.content.length<h&&(e.scrollState=!1,0==i.content.length&&1==n&&(e.no_content=!0)),1==o?(e.jianzhi_info=e.jianzhi_info.concat(i.content),i.content.length<h&&c.MessageShow("没有更多数据",1e3)):0==o?(e.jianzhi_info=i.content,i.content.length<1&&c.MessageShow("暂时没有兼职",1e3)):(e.jianzhi_info=i.content,c.MessageShow("刷新成功",1e3),i.content.length<1&&c.MessageShow("没有更多数据",1e3))):401==i.code?(l.go("adminLogin"),c.MessageShow(i.content,1e3)):(e.scrollState=!1,c.MessageShow(i.content,1e3)),t()},function(n){c.MessageShow("网络错误",2e3),e.scrollState=!1,t()})},p=function(e){for(var n=0;n<e.length;n++){var t=e[n].start_time.split("-"),o=e[n].end_time.split("-");e[n].time=t[1]+"."+t[2]+"-"+o[1]+"."+o[2]+" "+t[0],e[n].state={9:!0,8:!1}[e[n].state]}};e.addItems=function(){d+=1,setTimeout(function(){S(d,function(){e.$broadcast("scroll.infiniteScrollComplete")},1)},1e3)},e.doRefresh=function(){console.log("refresh"),d=1,S(d,function(){e.$broadcast("scroll.refreshComplete"),e.scrollState=!0},2)},e.down=function(t){n.show({cssClass:"enroll_popup",title:"提示",scope:e,buttons:[{text:"取消",type:"button-clear",onTap:function(e){console.log("cancle")}},{text:"确定",type:"button-clear",onTap:function(e){a.getData("/item/admin/down","POST",{iid:t.iid},u.token).then(function(e){200==e.code?(t.state=0,c.MessageShow("下线成功",1e3)):c.MessageShow(e.content,1e3)},function(e){c.MessageShow("网络错误",1e3)})}}],template:"<p>确定下线该兼职?</p>"})};var w=function(n){a.getData("/record/admin/list","POST",{iid:n},u.token).then(function(n){console.log(n),200==n.code?(e.current_item_record=n.content,n.content.length<1&&(e.current_item_record.is_empty=!0)):c.MessageShow("获取兼职报名详细失败",1e3)},function(e){c.MessageShow("获取兼职报名详细失败",1e3)})};e.operate_record=function(e,n){a.getData("/record/admin/change","POST",{rid:e.rid,state:n},u.token).then(function(t){200==t.code?(c.MessageShow("操作成功",1e3),e.state=n):c.MessageShow(t.content,1e3)},function(e){c.MessageShow("网络错误",1e3)})},e.detail=function(n){e.current_item=n,w(n.iid),e.modal.show()},e.quit=function(){e.modal.hide()},i.$on("update",function(){console.log("update"),e.scrollState=!0,S(d,function(){},0)}),e.jianzhi_info=m,e.scrollState=f,g()}]).controller("adminLoginCtrl",["Admin","$scope","$log","MessageShow","$state","$stateParams","EventService",function(e,n,t,o,i,a,s){n.formData={login_username:"",login_password:""};var c="admin.jianzhi",r=function(e){return e.login_username.length<1?"用户名不能为空!":e.login_password.length<1?"密码不能为空":null},l=function(){var t=r(n.formData);t?n.error_message=t:e.login(n.formData.login_username,n.formData.login_password).then(function(e){e?n.error_message=e:(o.MessageShow("登录成功",1e3),s.broadcast("update"),i.transitionTo(c,{},{reload:!0,notify:!0}))},function(e){o.MessageShow("网络错误",1e3)})};n.login=l}]).controller("NewCtrl",["$scope","Admin","MessageShow","callApi","$state","EventService","$rootScope",function(e,n,t,o,a,s,c){function r(){n.judgeUser()&&(t.MessageShow("请先登录",1e3),a.go("adminLogin"))}console.log("start");var l=n.getCurrentUser(),g={price:"",wanted_number:"",location:"",detail:"",start_time:"",end_time:"",name:""},u=function(){for(i in g)if(g[i].length<1)return"基础信息不能为空";return null},d=function(){var n=u();n?e.error_message=n:o.getData("/item/admin/new","POST",g,l.token).then(function(e){200!=e.code?t.MessageShow(e.content,2e3):(a.go("admin.jianzhi"),t.MessageShow("发布成功",1e3))},function(e){t.MessageShow("网络错误",2e3)})};e.info=g,e.newJianzhi=d,r()}]);
angular.module("JianzhiApp.services",[]).service("Storage",["ENV",function(e){this.set=function(e,n){return window.localStorage.setItem(e,window.JSON.stringify(n))},this.get=function(e){return window.JSON.parse(window.localStorage.getItem(e))},this.remove=function(e){return window.localStorage.removeItem(e)}}]).service("Admin",["Storage","callApi","$q","$log",function(e,n,t,o){var r="jianzhiadmin",i=e.get(r)||{};o.debug("admin service start"),this.login=function(o,a){return data={admin:o,password:a},loginDefer=t.defer(),n.getData("/admin/login","POST",data).then(function(n){200==n.code?(i.token=n.content,e.set(r,i),loginDefer.resolve(null)):loginDefer.resolve(n.content)},function(e){loginDefer.reject(e)}),loginDefer.promise},this.logout=function(){e.remove(r),$rootScope.admin=null},this.judgeUser=function(){for(name in i)return!1;return!0},this.getCurrentUser=function(){return i}}]).service("MessageShow",["$ionicLoading",function(e){this.errorShow=function(n){e.show({template:n,noBackdrop:!0,duration:2e3})},this.MessageShow=function(n,t){var t=2e3|t;e.show({template:n,noBackdrop:!0,duration:t})},this.show=function(n){e.show({template:n,noBackdrop:!0})},this.hide=function(){e.hide()}}]).service("EventService",["$rootScope",function(e){var n={broadcast:function(n){setTimeout(function(){e.$broadcast(n)},100)}};return n}]).service("callApi",["$http","ENV","$q","$log",function(e,n,t,o){var r=1;this.namedata=function(){return r},this.getData=function(o,r,i,a,c){var s=t.defer(),u=n.api+o;i=i||null,c=c||null;var d={method:r,url:u,headers:{admin:a},timeout:5e3};return"GET"==r?d.params=i:"POST"==r&&(c||(d.transformRequest=function(e){var n=[];for(var t in e)"data"!=t?n.push(encodeURIComponent(t)+"="+encodeURIComponent(e[t])):n.push(encodeURIComponent(t)+"="+JSON.stringify(e[t]));return n.join("&")}),d.headers["Content-Type"]="application/x-www-form-urlencoded",d.data=i),e(d).success(function(e){s.resolve(e)}).error(function(e,n,t){s.reject(e)}),s.promise}}]);